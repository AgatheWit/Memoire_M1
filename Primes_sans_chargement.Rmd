---
title: "Primes longévité et décès sans chargement"
output: html_document
date: "2022-2023"
header-includes:
   - \usepackage{pifont} 
   - \usepackage{manfnt}
   - \usepackage{mdframed}
   - \usepackage{systeme}
   - \usepackage{txfonts}
   - \newcommand{\cH}{\mathcal{H}}
---


\vspace{5cm}
\begin{center}
\begin{Large}
\underline{Formateur} :
\vspace{2cm}
\end{Large}
\end{center}

\newpage

#Packages

```{r ,message=FALSE}
library(readxl)
```

#On se place dans le bon 'Working Directory' et on vide notre environnement 
```{r}
rm(list=ls())
setwd("~/Documents/Dauphine M1/Mémoire")
```


#Calcul des primes uniques et annuelle, version sans chargement 

Pour toutes les primes qui vont être adressées ici, nous allons successivement faire varier l'âge des crédirentiers et débirentiers et déterminer les primes pour les différents âges étudiés. 
Commençons par créer un vecteur regroupant tous les âges des crédirentiers que nous voulons étudier, lorsque nous faisons varier l'âge du crédirentier. 
```{r}
age<-seq(60,100,5)
annee_naissance<-2022-age
l<-length(age)
```


##On commence par importer les tables nécessaires pour la suite 

###Tables TVH00-02/TVF00-02
```{r}

Table_TV<-read_excel("Tables_TV.xlsx", sheet = 1)
matrice_TV<-as.matrix(Table_TV)[2:114,c(2,4,6,8)]
TVH_vie<-as.integer(matrice_TV[,4])
TVF_vie<-as.integer(matrice_TV[,2])
TVH_deces<-as.integer(matrice_TV[,3])
TVH_deces[112:113]<-c(0,0) #on ajoute des zéros dans les cases sans données 
TVF_deces<-as.integer(matrice_TV[,1])
```
L'utilisation des tables du moment est légèrement différente de l'utilisation de tables prospectives, dans le sens où un décalage est à considérer. Ce n'est pas le cas pour les tables prospectives, ces dernières prenant naturellement en compte le décalage (il n'est pas à ajouter manuellement). \\
Ainsi, en fonction des tables considérées, nous appliquerons le décalage inscrit dans le code des Assurances.
```{r}
decalage_H_TV<-c(rep(0,16),rep(-13,23),rep(-7,24),rep(-6,2),rep(-4,10),rep(-3,38)) #associe à chaque indice (qui correspond à l'âge+1) le décalage à prendre en compte
decalage_F_TV<-c(rep(0,16),rep(-11,17), rep(-8,2), rep(-6,16),rep(-5,10), rep(-4,7), rep(-3,10), rep(-2,13), rep(-1,3), rep(0,19))
```
Modifications des tables afin qu'elles prennent en compte le décalage: 
```{r}
leng<-length(TVH_vie)
TVH_vie_decal<-apply(matrix(seq(1:leng), nrow=leng),1,function (x) TVH_vie[x+decalage_H_TV[x]])
TVF_vie_decal<-apply(matrix(seq(1:leng), nrow=leng),1,function (x) TVF_vie[x+decalage_F_TV[x]])
TVH_deces_decal<-apply(matrix(seq(1:leng), nrow=leng),1,function (x) TVH_deces[x+decalage_H_TV[x]])
TVF_deces_decal<-apply(matrix(seq(1:leng), nrow=leng),1,function (x) TVF_deces[x+decalage_F_TV[x]])
```
Les tables définies dans la partie de code ci-dessus sont donc celles à considérer par la suite. 
###Tables TGH05/TGF05
```{r}
Table_TG_H<-read_excel("TGH05_TGF05.xlsx", sheet = 2)
Table_TG_F<-read_excel("TGH05_TGF05.xlsx", sheet = 1)
matrice_TG_H<-as.matrix(Table_TG_H[2:123,2:107]) #on supprime les titres et la colonne des ages 
matrice_TG_F<-as.matrix(Table_TG_F[2:123,2:107])
```

##Calcul des espérances résiduelles 

A partir des différentes tables, nous pouvons déterminer les espérances de vie résiduelles d'individus. Les fonctions détaillées ici seront utilisées plus tard dans le code pour déterminer les espérances de vie résiduelles des crédirentiers et débirentiers. La formule utilisée dans les foncions et détaillée dans le mémoire est la suivante:
\[
E[T_x]= \sum_{k=1}^{\omega-x}~_kp_x
\]
La fonction utilisée pour les tables générationnelles varie de celle utilisée pour les tables prospectives.\\
En supposant age un vecteur contenant les ages des individus dont nous voulons connaître l'espérance de vie résiduelle et table la table de mortalité rendant compte des $l_x$, on obtient les formules suivantes:

###Table des moments
```{r}
esperance_TV<-function(age,table){#prendre en compte la table avec décalage
  esp<-apply(matrix(seq(1,length(age)), nrow=length(age)),1, function(x) sum(table[(age[x]+2):length(table)])/table[age[x]+1])
  return(esp)
}
```
On peut désormais déterminer l'espérance résiduelle des individus dont les âges sont compris dans le vecteur 'age', en fonction des tables TVH00-02/TVF00-02:\\
```{r}
esp_femme_TV<-esperance_TV(age,TVF_vie_decal) #espérances pour les femmes 
esp_homme_TV<-esperance_TV(age,TVH_vie_decal) #espérances pour les hommes
```

###Table prospective
```{r}
esperance_residuelle_Lx<-function(age,table){
  annee_naissance<-2022-age
  omega<-length(table[,1])
  esper<-apply(matrix(seq(1,length(age)), nrow=length(age)),1, function (x) sum(table[(age[x]+2):omega, (annee_naissance[x]-1899)] / table[(age[x]+1),(annee_naissance[x]-1899)]))
  return(esper)
}
```
On peut désormais déterminer l'espérance résiduelle des individus dont les âges sont compris dans le vecteur 'age', en fonction des tables TGH05/TGF05:\\
```{r}
esp_femme<-esperance_residuelle_Lx(age,matrice_TG_F) #espérances pour les femmes 
esp_homme<-esperance_residuelle_Lx(age,matrice_TG_H) #espérances pour les hommes
```
Comparons les différentes espérances de vie obtenues:
```{r}
par(mfrow=c(1,2))

plot(age, esp_homme, type="l", lwd=3, col='royalblue1', main='Espérances résiduelles en fonction de l\'âge d\'un individu homme', xlab='âge de l\'individu', ylab = 'Espérance de vie résiduelle', ylim=c(0,40))
lines(age, esp_homme_TV, type="l", lwd=3, col='paleturquoise1')
legend(
  'topright',
  c('table TGH05', 'table TVH00-02'),
  col = c('royalblue1','paleturquoise1'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)

plot(age, esp_femme, type="l", lwd=3, col='sandybrown', main='Espérances résiduelles en fonction de l\'âge d\'un individu femme', xlab='âge de l\'individu', ylab = 'Espérance de vie résiduelle', ylim=c(0,40))
lines(age, esp_femme_TV, type="l", lwd=3, col='peachpuff2')
legend(
  'topright',
  c('table TGF05', 'table TVF00-02'),
  col = c('sandybrown','peachpuff2'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)
```

##Calcul du DUH et de la Rente

On se place dans le cadre d'un bien de valeur vénale de 500 000€ et de loyer de 15 000€. On suppose également que le bien est intégralement payé sous forme de rente (il n'y a pas de bouquet).
```{r}
Loyer=15000
```

###Calcul sur une tête

Pour les tables TGH05/TGF05:

```{r}
#Détermination du DUH 
Omega<-length(matrice_TG_H[,1])-1 #âge maximal atteint par un individu 
v<-1/(1+0.02)

DUH_1_H<-function(x){
  actualisation<-cumprod(rep(v,Omega-age[x]))
  probas_survie_homme<-matrice_TG_H[(age[x]+2):(Omega+1), (annee_naissance[x]-1899)]/matrice_TG_H[(age[x]+1), (annee_naissance[x]-1899)]
  return(sum(actualisation*probas_survie_homme)*Loyer)
}

DUH_1_F<-function(x){
  actualisation<-cumprod(rep(v,Omega-age[x]))
  probas_survie_femme<-matrice_TG_F[(age[x]+2):(Omega+1), (annee_naissance[x]-1899)]/matrice_TG_F[(age[x]+1), (annee_naissance[x]-1899)]
  return(sum(actualisation*probas_survie_femme)*Loyer)
}

#Détermination de la rente

Rente_1_H<-function(x){
  Capital_1_homme<-500000-DUH_1_H(x)
  actualisation<-cumprod(c(1,rep(v,Omega-age[x])))
  probas_survie_homme<-matrice_TG_H[(age[x]+1):(Omega+1), (annee_naissance[x]-1899)]/matrice_TG_H[(age[x]+1), (annee_naissance[x]-1899)]
  return(Capital_1_homme/sum(actualisation*probas_survie_homme))
}

Rente_1_F<-function(x){
  Capital_1_femme<-500000-DUH_1_F(x)
  actualisation<-cumprod(c(1,rep(v,Omega-age[x])))
  probas_survie_femme<-matrice_TG_F[(age[x]+1):(Omega+1), (annee_naissance[x]-1899)]/matrice_TG_F[(age[x]+1), (annee_naissance[x]-1899)]
  return(Capital_1_femme/sum(actualisation*probas_survie_femme))
}

Rente_1_homme<-apply(matrix(seq(1:length(age)), nrow=length(age)), 1, Rente_1_H)
Rente_1_femme<-apply(matrix(seq(1:length(age)), nrow=length(age)), 1, Rente_1_F)

```

Pour les tables TVH00-02/TVF00-02:(vie)

```{r}
#Détermination du DUH 
omega<-length(TVH_vie_decal)-1
v<-1/(1+0.02)

DUH_1_H_TV<-function(x){
  actualisation<-cumprod(rep(v,omega-age[x]))
  probas_survie_homme<-TVH_vie_decal[(age[x]+2):(omega+1)]/TVH_vie_decal[(age[x]+1)]
  return(sum(actualisation*probas_survie_homme)*Loyer)
}

DUH_1_F_TV<-function(x){
  actualisation<-cumprod(rep(v,omega-age[x]))
  probas_survie_femme<-TVF_vie_decal[(age[x]+2):(omega+1)]/TVF_vie_decal[(age[x]+1)]
  return(sum(actualisation*probas_survie_femme)*Loyer)
}

#Détermination de la rente

Rente_1_H_TV<-function(x){
  Capital_1_homme<-500000-DUH_1_H_TV(x)
  actualisation<-cumprod(c(1,rep(v,omega-age[x])))
  probas_survie_homme<-TVH_vie_decal[(age[x]+1):(omega+1)]/TVH_vie_decal[(age[x]+1)]
  return(Capital_1_homme/sum(actualisation*probas_survie_homme))
}

Rente_1_F_TV<-function(x){
  Capital_1_femme<-500000-DUH_1_F_TV(x)
  actualisation<-cumprod(c(1,rep(v,omega-age[x])))
  probas_survie_femme<-TVF_vie_decal[(age[x]+1):(omega+1)]/TVF_vie_decal[(age[x]+1)]
  return(Capital_1_femme/sum(actualisation*probas_survie_femme))
}

Rente_1_homme_TV<-apply(matrix(seq(1:length(age)), nrow=length(age)), 1, Rente_1_H_TV)
Rente_1_femme_TV<-apply(matrix(seq(1:length(age)), nrow=length(age)), 1, Rente_1_F_TV)

```
Comparons les différentes rentes obtenues: 
```{r}
par(mfrow=c(1,2))

plot(age, Rente_1_homme, type="l", lwd=3, col='royalblue1', main='Rente sur une tête en fonction de l\'âge d\'un crédirentier homme', xlab='âge du crédirentier', ylab = 'Rente annuelle', ylim=c(0,180000))
lines(age, Rente_1_homme_TV, type="l", lwd=3, col='paleturquoise1')
legend(
  'topleft',
  c('table TGH05', 'table TVH00-02'),
  col = c('royalblue1','paleturquoise1'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)

plot(age, Rente_1_femme, type="l", lwd=3, col='sandybrown', main='Rente sur une tête en fonction de l\'âge d\'un crédirentier femme', xlab='âge du crédirentier', ylab = 'Rente annuelle', ylim=c(0,180000))
lines(age, Rente_1_femme_TV, type="l", lwd=3, col='peachpuff2')
legend(
  'topleft',
  c('table TGF05', 'table TVF00-02'),
  col = c('sandybrown','peachpuff2'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)
```


###Calcul sur deux têtes (avec indépendance)

Nous considérons comme dans le mémoire un couple de crédirentier, avec: 
\begin{itemize}
\item credirentier_1 le crédirentier homme
\item credirentier_2 le crédirentier femme
\end{itemize}

Pour les tables TGH05/TGF05:

```{r}

DUH_2_T<-function(x_1,x_2){ #attention x_1 et x_2 ne représentent pas les âges mais la position de l'âge des individus considérés dans le vecteur 'age'
  x<-min(x_1,x_2)
  actualisation<-cumprod(rep(v,Omega-age[x]))
  if(x_1>x_2){
    probas_survie_homme<-c(matrice_TG_H[(age[x_1]+2):(Omega+1), (annee_naissance[x_1]-1899)]/matrice_TG_H[(age[x_1]+1), (annee_naissance[x_1]-1899)],rep(0,age[x_1]-age[x_2])) #L'idée est d'obtenir des vecteurs de même taille, et une fois l'âge final dépassé, la probabilité de survie est nulle 
    probas_survie_femme<-matrice_TG_F[(age[x_2]+2):(Omega+1), (annee_naissance[x_2]-1899)]/matrice_TG_F[(age[x_2]+1), (annee_naissance[x_2]-1899)]
  }
  if(x_1<x_2){
    probas_survie_homme<-matrice_TG_H[(age[x_1]+2):(Omega+1), (annee_naissance[x_1]-1899)]/matrice_TG_H[(age[x_1]+1), (annee_naissance[x_1]-1899)]
    probas_survie_femme<-c(matrice_TG_F[(age[x_2]+2):(Omega+1), (annee_naissance[x_2]-1899)]/matrice_TG_F[(age[x_2]+1), (annee_naissance[x_2]-1899)],rep(0,age[x_2]-age[x_1]))
  }
  if(x_1==x_2){
    probas_survie_homme<-matrice_TG_H[(age[x_1]+2):(Omega+1), (annee_naissance[x_1]-1899)]/matrice_TG_H[(age[x_1]+1), (annee_naissance[x_1]-1899)]
    probas_survie_femme<-matrice_TG_F[(age[x_2]+2):(Omega+1), (annee_naissance[x_2]-1899)]/matrice_TG_F[(age[x_2]+1), (annee_naissance[x_2]-1899)]
  }
  return(Loyer*sum(actualisation*(probas_survie_homme+probas_survie_femme-probas_survie_homme*probas_survie_femme)))
}

Rente_2_T<-function(x_1,x_2){
  Capital_rente<-500000-DUH_2_T(x_1,x_2)
  x<-min(x_1,x_2)
  actualisation<-cumprod(c(1,rep(v,Omega-age[x])))
  if(x_1>x_2){
    probas_survie_homme<-c(matrice_TG_H[(age[x_1]+1):(Omega+1), (annee_naissance[x_1]-1899)]/matrice_TG_H[(age[x_1]+1), (annee_naissance[x_1]-1899)],rep(0,age[x_1]-age[x_2]))
    probas_survie_femme<-matrice_TG_F[(age[x_2]+1):(Omega+1), (annee_naissance[x_2]-1899)]/matrice_TG_F[(age[x_2]+1), (annee_naissance[x_2]-1899)]
  }
  if(x_1<x_2){
    probas_survie_homme<-matrice_TG_H[(age[x_1]+1):(Omega+1), (annee_naissance[x_1]-1899)]/matrice_TG_H[(age[x_1]+1), (annee_naissance[x_1]-1899)]
    probas_survie_femme<-c(matrice_TG_F[(age[x_2]+1):(Omega+1), (annee_naissance[x_2]-1899)]/matrice_TG_F[(age[x_2]+1), (annee_naissance[x_2]-1899)],rep(0,age[x_2]-age[x_1]))
  }
  if(x_1==x_2){
    probas_survie_homme<-matrice_TG_H[(age[x_1]+1):(Omega+1), (annee_naissance[x_1]-1899)]/matrice_TG_H[(age[x_1]+1), (annee_naissance[x_1]-1899)]
    probas_survie_femme<-matrice_TG_F[(age[x_2]+1):(Omega+1), (annee_naissance[x_2]-1899)]/matrice_TG_F[(age[x_2]+1), (annee_naissance[x_2]-1899)]
  }
  return(Capital_rente/sum(actualisation*(probas_survie_homme+probas_survie_femme-probas_survie_homme*probas_survie_femme)))
}

#Quand on fait varier le crédirentier 1:  (âge credirentier_2 fixe: 80 ans)
Rente_2_var_1<-function(x){
  return(Rente_2_T(x,5))
}

Rente_2_var_homme<-apply(matrix(seq(1,length(age)), nrow=length(age)), 1, Rente_2_var_1)

#Quand on fait varier le crédirentier 2:  (âge credirentier_1 fixe: 80 ans)

Rente_2_var_2<-function(x){
  return(Rente_2_T(5,x))
}

Rente_2_var_femme<-apply(matrix(seq(1,length(age)), nrow=length(age)), 1, Rente_2_var_2)
```

Pour les tables TVH00-02/TVF00-02:(vie)
```{r}
DUH_2_T_TV<-function(x_1,x_2){ #attention x_1 et x_2 ne représentent pas les âges mais la position de l'âge des individus considérés dans le vecteur 'age'
  x<-min(x_1,x_2)
  actualisation<-cumprod(rep(v,omega-age[x]))
  if(x_1>x_2){
    probas_survie_homme<-c(TVH_vie_decal[(age[x_1]+2):(omega+1)]/TVH_vie_decal[(age[x_1]+1)],rep(0,age[x_1]-age[x_2]))
    probas_survie_femme<-TVF_vie_decal[(age[x_2]+2):(omega+1)]/TVF_vie_decal[(age[x_2]+1)]
  }
  if(x_1<x_2){
    probas_survie_homme<-TVH_vie_decal[(age[x_1]+2):(omega+1)]/TVH_vie_decal[(age[x_1]+1)]
    probas_survie_femme<-c(TVF_vie_decal[(age[x_2]+2):(omega+1)]/TVF_vie_decal[(age[x_2]+1)],rep(0,age[x_2]-age[x_1]))
  }
  if(x_1==x_2){
    probas_survie_homme<-TVH_vie_decal[(age[x_1]+2):(omega+1)]/TVH_vie_decal[(age[x_1]+1)]
    probas_survie_femme<-TVF_vie_decal[(age[x_2]+2):(omega+1)]/TVF_vie_decal[(age[x_2]+1)]
  }
  return(Loyer*sum(actualisation*(probas_survie_homme+probas_survie_femme-probas_survie_homme*probas_survie_femme)))
}

Rente_2_T_TV<-function(x_1,x_2){
  Capital_rente<-500000-DUH_2_T_TV(x_1,x_2)
  x<-min(x_1,x_2)
  actualisation<-cumprod(c(1,rep(v,omega-age[x])))
  if(x_1>x_2){
    probas_survie_homme<-c(TVH_vie_decal[(age[x_1]+1):(omega+1)]/TVH_vie_decal[(age[x_1]+1)],rep(0,age[x_1]-age[x_2]))
    probas_survie_femme<-TVF_vie_decal[(age[x_2]+1):(omega+1)]/TVF_vie_decal[(age[x_2]+1)]
  }
  if(x_1<x_2){
    probas_survie_homme<-TVF_vie_decal[(age[x_1]+1):(omega+1)]/TVF_vie_decal[(age[x_1]+1)]
    probas_survie_femme<-c(TVF_vie_decal[(age[x_2]+1):(omega+1)]/TVF_vie_decal[(age[x_2]+1)],rep(0,age[x_2]-age[x_1]))
  }
  if(x_1==x_2){
    probas_survie_homme<-TVH_vie_decal[(age[x_1]+1):(omega+1)]/TVH_vie_decal[(age[x_1]+1)]
    probas_survie_femme<-TVF_vie_decal[(age[x_2]+1):(omega+1)]/TVF_vie_decal[(age[x_2]+1)]
  }
  return(Capital_rente/sum(actualisation*(probas_survie_homme+probas_survie_femme-probas_survie_homme*probas_survie_femme)))
}

#Quand on fait varier le crédirentier 1: (âge credirentier_2 fixe: 80 ans)
Rente_2_var_1_TV<-function(x){
  return(Rente_2_T_TV(x,5))
}

Rente_2_var_homme_TV<-apply(matrix(seq(1,length(age)), nrow=length(age)), 1, Rente_2_var_1_TV)

#Quand on fait varier le crédirentier 2: (âge credirentier_1 fixe: 80 ans)

Rente_2_var_2_TV<-function(x){
  return(Rente_2_T_TV(5,x))
}

Rente_2_var_femme_TV<-apply(matrix(seq(1,length(age)), nrow=length(age)), 1, Rente_2_var_2_TV)

```

Comparons les différentes rentes obtenues:
```{r}
par(mfrow=c(1,2))

plot(age, Rente_2_var_homme, type="l", lwd=3, col='royalblue1', main='Rente sur deux têtes en fonction de l\'âge d\'un crédirentier homme, avec crédirentière fixe (80 ans)', xlab='âge du crédirentier', ylab = 'Rente annuelle', ylim=c(0,40000))
lines(age, Rente_2_var_homme_TV, type="l", lwd=3, col='paleturquoise1')
legend(
  'topleft',
  c('table TGH05', 'table TVH00-02'),
  col = c('royalblue1','paleturquoise1'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)

plot(age, Rente_2_var_femme, type="l", lwd=3, col='sandybrown', main='Rente sur deux têtes en fonction de l\'âge d\'un crédirentier femme, avec crédirentier fixe (80 ans)', xlab='âge du crédirentier', ylab = 'Rente annuelle', ylim=c(0,40000))
lines(age, Rente_2_var_femme_TV, type="l", lwd=3, col='peachpuff2')
legend(
  'topleft',
  c('table TGF05', 'table TVF00-02'),
  col = c('sandybrown','peachpuff2'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)
```

Nous pouvons désormais passer à l'étude des différentes primes en fonction des produits considérés. 

##Prime maximale, risque longévité sur une tête

Nous considérons ici le produit assurantiel qui couvre le risque de longévité sur une tête quand il n'y a pas de limitation dans la période de prise en charge de l'assureur.

###Tables TGH05/TGF05
```{r}
Omega<-length(matrice_TG_H[,1])-1 #âge maximal, on le redétermine par lisibilité

#Prime Unique 

Produit_final_homme<-numeric(l)
Produit_final_femme<-numeric(l)
for (x in 1:length(age)){
  actualisation_max_homme<-cumprod(rep(v,Omega-(age[x]+floor(esp_homme[x]))))*(v**floor(esp_homme[x]))
  actualisation_max_femme<-cumprod(rep(v,Omega-(age[x]+floor(esp_femme[x]))))*(v**floor(esp_femme[x]))
  L_homme<-matrice_TG_H[(age[x]+ceiling(esp_homme[x])+1):(Omega+1), (annee_naissance[x]-1899)] / matrice_TG_H[(age[x]+1), (annee_naissance[x]-1899)]
  L_femme<-matrice_TG_F[(age[x]+ceiling(esp_femme[x])+1):(Omega+1), (annee_naissance[x]-1899)] / matrice_TG_F[(age[x]+1), (annee_naissance[x]-1899)]
  Produit_final_homme[x]<-Rente_1_homme[x]*sum(L_homme*actualisation_max_homme)
  Produit_final_femme[x]<-Rente_1_femme[x]*sum(L_femme*actualisation_max_femme)
}


#En Prime Annuelle (en supposant la prime souscrite au temps 0) (débirentier fixe homme de 40 ans)
#On détermine le dénominateur 

Denominateur_homme<-numeric(l)
Denominateur_femme<-numeric(l)
for (x in 1:length(age)){
  actualisation_deno_homme<-cumprod(c(1,rep(v,floor(esp_homme[x]))))
  actualisation_deno_femme<-cumprod(c(1,rep(v,floor(esp_femme[x]))))
  L_cred_homme<-matrice_TG_H[(age[x]+1):(age[x]+ceiling(esp_homme[x])), (annee_naissance[x]-1899)] / matrice_TG_H[(age[x]+1), (annee_naissance[x]-1899)]
  L_deb_homme<-matrice_TG_H[(40+1):(40+ceiling(esp_homme[x])), (2022-40-1899)] / matrice_TG_H[(40+1), (2022-40-1899)]
  L_cred_femme<-matrice_TG_F[(age[x]+1):(age[x]+ceiling(esp_femme[x])), (annee_naissance[x]-1899)] / matrice_TG_F[(age[x]+1), (annee_naissance[x]-1899)]
  L_deb_femme<-matrice_TG_H[(40+1):(40+ceiling(esp_femme[x])), (2022-40-1899)] / matrice_TG_H[(40+1), (2022-40-1899)]
  Denominateur_homme[x]<-sum(L_cred_homme*L_deb_homme*actualisation_deno_homme)
  Denominateur_femme[x]<-sum(L_cred_femme*L_deb_femme*actualisation_deno_femme)
}

Prime_annuelle_max_homme<-Produit_final_homme/Denominateur_homme
Prime_annuelle_max_femme<-Produit_final_femme/Denominateur_femme
```
Graphiquement, nous obtenons:
```{r}
plot(age, Produit_final_homme, type="l", lwd=3, col='tomato3', main='Prime Unique risque longévité sur une tête - couverture maximale - tables TGH05/TGF05 ', xlab='âge du crédirentier', ylab = 'Prime maximale', ylim=c(0,200000))
lines(age, Produit_final_femme, type="l", lwd=3, col='blue')
legend(
  'topleft',
  c('crédirentier homme', 'crédirentier femme'),
  col = c('tomato3','blue'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)
```
et
```{r}
plot(age, Prime_annuelle_max_homme, type="l", lwd=3, col='tomato3', main='Prime Annuelle risque longévité sur une tête - couverture maximale - tables TGH05/TGF05', xlab='âge du crédirentier', ylab = 'Prime maximale', ylim=c(0,120000))
lines(age, Prime_annuelle_max_femme, type="l", lwd=3, col='blue')
legend(
  'topleft',
  c('crédirentier homme', 'crédirentier femme'),
  col = c('tomato3','blue'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)
```
###Tables TVH00-02/TVF00-02

```{r}
omega<-length(TVH_vie_decal)-1 #âge maximal atteint par un individu  

#Prime Unique 

Prime_unique_max_homme_TV<-numeric(l)
Prime_unique_max_femme_TV<-numeric(l)
for (x in 1:length(age)){
  actualisation_max_homme<-cumprod(rep(v,omega-(age[x]+floor(esp_homme_TV[x]))))*(v**floor(esp_homme_TV[x]))
  actualisation_max_femme<-cumprod(rep(v,omega-(age[x]+floor(esp_femme_TV[x]))))*(v**floor(esp_femme_TV[x]))
  L_homme<-TVH_vie_decal[(age[x]+ceiling(esp_homme_TV[x])+1):(omega+1)] / TVH_vie_decal[(age[x]+1)]
  L_femme<-TVF_vie_decal[(age[x]+ceiling(esp_femme_TV[x])+1):(omega+1)] / TVF_vie_decal[(age[x]+1)]
  Prime_unique_max_homme_TV[x]<-Rente_1_homme_TV[x]*sum(L_homme*actualisation_max_homme)
  Prime_unique_max_femme_TV[x]<-Rente_1_femme_TV[x]*sum(L_femme*actualisation_max_femme)
}

#En Prime Annuelle (en supposant la prime souscrite au temps 0) (débirentier fixe homme de 40 ans)
#On détermine le dénominateur 

Denominateur_homme_TV<-numeric(l)
Denominateur_femme_TV<-numeric(l)
for (x in 1:length(age)){
  actualisation_deno_homme<-c(1,rep(v,floor(esp_homme_TV[x])))
  actualisation_deno_femme<-c(1,rep(v,floor(esp_femme_TV[x])))
  L_cred_homme<-TVH_vie_decal[(age[x]+1):(age[x]+ceiling(esp_homme_TV[x]))] / TVH_vie_decal[(age[x]+1)]
  L_deb_homme<-TVH_vie_decal[(40+1):(40+ceiling(esp_homme_TV[x]))] / TVH_vie_decal[(40+1)]
  L_cred_femme<-TVF_vie_decal[(age[x]+1):(age[x]+ceiling(esp_femme_TV[x]))] / TVF_vie_decal[(age[x]+1)]
  L_deb_femme<-TVH_vie_decal[(40+1):(40+ceiling(esp_femme_TV[x]))] / TVH_vie_decal[(40+1)]
  Denominateur_homme_TV[x]<-sum(L_cred_homme*L_deb_homme*actualisation_deno_homme)
  Denominateur_femme_TV[x]<-sum(L_cred_femme*L_deb_femme*actualisation_deno_femme)
}

Prime_annuelle_max_homme_TV<-Prime_unique_max_homme_TV/Denominateur_homme_TV
Prime_annuelle_max_femme_TV<-Prime_unique_max_femme_TV/Denominateur_femme_TV
```
On peut désormais implémenter les graphiques. On obtient 
```{r}
plot(age, Prime_unique_max_homme_TV, type="l", lwd=3, col='tomato3', main='Prime Unique risque longévité sur une tête - couverture maximale - tables TVH00-02/TVF00-02', xlab='âge du crédirentier', ylab = 'Prime maximale', ylim=c(0,200000))
lines(age, Prime_unique_max_femme_TV, type="l", lwd=3, col='blue')
legend(
  'topleft',
  c('crédirentier homme', 'crédirentier femme'),
  col = c('tomato3','blue'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)
```
et 
```{r}
plot(age, Prime_annuelle_max_homme_TV, type="l", lwd=3, col='tomato3', main='Prime Annuelle risque longévité sur une tête - couverture maximale - tables TVH00-02/TVF00-02', xlab='âge du crédirentier', ylab = 'Prime maximale', ylim=c(0,160000))
lines(age, Prime_annuelle_max_femme_TV, type="l", lwd=3, col='blue')
legend(
  'topleft',
  c('crédirentier homme', 'crédirentier femme'),
  col = c('tomato3','blue'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)

```

##Prime longévité sur une tête

###Tables TGH05/TGF05

Nous nous plaçons dans un cadre où le débirentier est fixé. Nous faisons varier l'âge du crédirentier. Il prend successivement les âges contenus dans le vecteur 'age'.  
```{r}
#détermination des paramètres n et u

n_h<-ceiling(esp_homme)+3
n_f<-ceiling(esp_femme)+3
u<-5

#Pour la création du tableau regroupant les différents x_min et x_max dans le Mémoire, on les détermine ici: 

x_min_homme<-age+n_h
x_min_femme<-age+n_f
x_max_homme<-x_min_homme+5
x_max_femme<-x_min_femme+5

#Prime unique

#On créer une matrice pour laquelle chaque colonne représente les facteurs d'actualisation v^k utilisés
#dans la formule pour un âge du crédirentier, les âges allant de 60 à 100
actu_1_femme<-matrix(rep(0,l*u), ncol=l)
actu_1_homme<-matrix(rep(0,l*u), ncol=l)

for (x in 1:l){
  actu_1_femme[,x]<-cumprod(rep(v,u))*(v**(n_f[x]-1))
  actu_1_homme[,x]<-cumprod(rep(v,u))*(v**(n_h[x]-1))
}

rente_1_femme<-numeric(l)
rente_1_homme<-numeric(l)

for (x in 1:l){
  probas_survie_femme<-matrice_TG_F[(age[x]+n_f[x]+1):(age[x]+n_f[x]+u), (annee_naissance[x]-1899)] / matrice_TG_F[(age[x]+1), (annee_naissance[x]-1899)]
  probas_survie_homme<-matrice_TG_H[(age[x]+n_h[x]+1):(age[x]+n_h[x]+u), (annee_naissance[x]-1899)] / matrice_TG_H[(age[x]+1), (annee_naissance[x]-1899)]
  rente_1_femme[x]<-sum(probas_survie_femme*actu_1_femme[,x])
  rente_1_homme[x]<-sum(probas_survie_homme*actu_1_homme[,x])
}

Prime_unique_1_femme<-Rente_1_femme*rente_1_femme
Prime_unique_1_homme<-Rente_1_homme*rente_1_homme


#Prime annuelle (on fixe le débirentier: homme de 40 ans)

Denominateur_1_homme<-numeric(l)
Denominateur_1_femme<-numeric(l)
for (x in 1:length(age)){
  actualisation_deno_homme<-cumprod(c(1,rep(v,n_h[x]-1)))
  actualisation_deno_femme<-cumprod(c(1,rep(v,n_f[x]-1)))
  L_cred_homme<-matrice_TG_H[(age[x]+1):(age[x]+n_h[x]), (annee_naissance[x]-1899)] / matrice_TG_H[(age[x]+1), (annee_naissance[x]-1899)]
  L_deb_homme<-matrice_TG_H[(40+1):(40+n_h[x]), (2022-40-1899)] / matrice_TG_H[(40+1), (2022-40-1899)]
  L_cred_femme<-matrice_TG_F[(age[x]+1):(age[x]+n_f[x]), (annee_naissance[x]-1899)] / matrice_TG_F[(age[x]+1), (annee_naissance[x]-1899)]
  L_deb_femme<-matrice_TG_H[(40+1):(40+n_f[x]), (2022-40-1899)] / matrice_TG_H[(40+1), (2022-40-1899)] #On adapte les L_x du débirentier à la période considérée
  Denominateur_1_homme[x]<-sum(L_cred_homme*L_deb_homme*actualisation_deno_homme)
  Denominateur_1_femme[x]<-sum(L_cred_femme*L_deb_femme*actualisation_deno_femme)
}

Prime_annuelle_1_homme<-Prime_unique_1_homme/Denominateur_1_homme
Prime_annuelle_1_femme<-Prime_unique_1_femme/Denominateur_1_femme

```
Graphiques associés au risque longévité sur une tête avec les tables TGH05/TGF05:
```{r}
plot(age, Prime_unique_1_homme, type="l", lwd=3, col='tomato3', main='Prime Unique risque longévité sur une tête - tables TGH05/TGF05', xlab='âge du crédirentier', ylab = 'Prime unique', ylim=c(0,45000))
lines(age, Prime_unique_1_femme, type="l", lwd=3, col='blue')
legend(
  'topleft',
  c('crédirentier homme', 'crédirentier femme'),
  col = c('tomato3','blue'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)

plot(age, Prime_annuelle_1_homme, type="l", lwd=3, col='tomato3', main='Prime Annuelle risque longévité sur une tête - tables TGH05/TGF05', xlab='âge du crédirentier', ylab = 'Prime annuelle', ylim=c(0,16000))
lines(age, Prime_annuelle_1_femme, type="l", lwd=3, col='blue')
legend(
  'topleft',
  c('crédirentier homme', 'crédirentier femme'),
  col = c('tomato3','blue'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)

```

###Tables TVH00-02/TVF00-02

```{r}

#détermination des paramètres n et u

n_h_TV=ceiling(esp_homme_TV)+3
n_f_TV=ceiling(esp_femme_TV)+3
u=5

#Pour la création du tableau regroupant les différents x_min et x_max dans le Mémoire, on les détermine ici: 

x_min_homme_TV<-age+n_h_TV
x_min_femme_TV<-age+n_f_TV
x_max_homme_TV<-x_min_homme_TV+5
x_max_femme_TV<-x_min_femme_TV+5


#Prime Unique

#On créer une matrice pour laquelle chaque colonne représente les facteurs d'actualisation v^k utilisés
#dans la formule pour un âge du crédirentier, les âges allant de 60 à 100
actu_1_femme<-matrix(rep(0,l*u), ncol=l)
actu_1_homme<-matrix(rep(0,l*u), ncol=l)

for (x in 1:l){
  actu_1_femme[,x]<-cumprod(rep(v,u))*(v**(n_f_TV[x]-1))
  actu_1_homme[,x]<-cumprod(rep(v,u))*(v**(n_h_TV[x]-1))
}

rente_1_femme<-numeric(l)
rente_1_homme<-numeric(l)

for (x in 1:l){
  probas_survie_femme<-TVF_vie_decal[(age[x]+n_f_TV[x]+1):(age[x]+n_f_TV[x]+u)] / TVF_vie_decal[(age[x]+1)]
  probas_survie_homme<-TVH_vie_decal[(age[x]+n_h_TV[x]+1):(age[x]+n_h_TV[x]+u)] / TVH_vie_decal[(age[x]+1)]
  rente_1_femme[x]<-sum(probas_survie_femme*actu_1_femme[,x])
  rente_1_homme[x]<-sum(probas_survie_homme*actu_1_homme[,x])
}

Prime_unique_1_femme_TV<-Rente_1_femme_TV*rente_1_femme
Prime_unique_1_homme_TV<-Rente_1_homme_TV*rente_1_homme


#Prime annuelle (on fixe le débirentier: homme de 40 ans)

Denominateur_1_homme_TV<-numeric(l)
Denominateur_1_femme_TV<-numeric(l)
for (x in 1:length(age)){
  actualisation_deno_homme<-cumprod(c(1,rep(v,n_h_TV[x]-1)))
  actualisation_deno_femme<-cumprod(c(1,rep(v,n_f_TV[x]-1)))
  L_cred_homme<-TVH_vie_decal[(age[x]+1):(age[x]+n_h_TV[x])] / TVH_vie_decal[(age[x]+1)]
  L_deb_homme<-TVH_vie_decal[(40+1):(40+n_h_TV[x])] / TVH_vie_decal[(40+1)]
  L_cred_femme<-TVF_vie_decal[(age[x]+1):(age[x]+n_f_TV[x])] / TVF_vie_decal[(age[x]+1)]
  L_deb_femme<-TVH_vie_decal[(40+1):(40+n_f_TV[x])] / TVH_vie_decal[(40+1)]
  Denominateur_1_homme_TV[x]<-sum(L_cred_homme*L_deb_homme*actualisation_deno_homme)
  Denominateur_1_femme_TV[x]<-sum(L_cred_femme*L_deb_femme*actualisation_deno_femme)
}

Prime_annuelle_1_homme_TV<-Prime_unique_1_homme_TV/Denominateur_1_homme_TV
Prime_annuelle_1_femme_TV<-Prime_unique_1_femme_TV/Denominateur_1_femme_TV
```
Graphiques associés au risque longévité sur une tête avec les tables TVH00-02/TVF00-02:
```{r}
plot(age, Prime_unique_1_homme_TV, type="l", lwd=3, col='tomato3', main='Prime Unique risque longévité sur une tête - tables TVH00-02/TVF00-02', xlab='âge du crédirentier', ylab = 'Prime unique', ylim=c(0,50000))
lines(age, Prime_unique_1_femme_TV, type="l", lwd=3, col='blue')
legend(
  'topleft',
  c('crédirentier homme', 'crédirentier femme'),
  col = c('tomato3','blue'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)

plot(age, Prime_annuelle_1_homme_TV, type="l", lwd=3, col='tomato3', main='Prime Annuelle risque longévité sur une tête - tables TVH00-02/TVF00-02', xlab='âge du crédirentier', ylab = 'Prime annuelle', ylim=c(0,15000))
lines(age, Prime_annuelle_1_femme_TV, type="l", lwd=3, col='blue')
legend(
  'topleft',
  c('crédirentier homme', 'crédirentier femme'),
  col = c('tomato3','blue'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)
```

##Prime longévité sur deux têtes, indépendance des deux crédirentiers 

On rappelle que Credirentier_1 correspond au crédirentier homme et Credirentier_2 correspond au crédirentier femme.\\
On va successivement faire varier l'âge du crédirentier homme et du crédirentier femme, en fixant l'âge de l'autre crédirentier à 80 ans. 

###Tables TGH05/TGF05

On commence par faire varier l'âge de Crédirentier_1.
```{r}
annee_naissance_2<-2022-80 #annee de naissance de la crédirentiere 
annee_naissance_1<-annee_naissance


#Prime unique

maxi<-numeric(l)
for (x in 1:l){
  maxi[x]<-ceiling(max(esp_homme[x],esp_femme[5]))
}
m_h<-ceiling(maxi)+3
u<-5 #même s'il a été déterminé auparavant, on le remet par lisibilité 

#Pour la suite des calculs, il faut redéterminer les facteurs d'actualisation, car nous allons de m à m+u-1
#et rien ne nous indique que m et n ont la même valeur 

Actu_1<-matrix(rep(0,l*u), ncol=l)

for (x in 1:l){
  Actu_1[,x]<-cumprod(rep(v,u))*(v**(m_h[x]-1))
}

#On passe désormais au calcul des différentes composantes de la formule finale
probas_survie_Homme_2_tetes<-matrix(rep(0, l*u),ncol=l) 
probas_survie_femme_2_tetes<-matrix(rep(0, l*u),ncol=l) 

for (x in 1:l){
  probas_survie_Homme_2_tetes[,x]<-matrice_TG_H[(age[x]+1+m_h[x]):(age[x]+m_h[x]+u), (annee_naissance_1[x]-1899)] / matrice_TG_H[(age[x]+1), (annee_naissance_1[x]-1899)]
  probas_survie_femme_2_tetes[,x]<-matrice_TG_F[(age[5]+1+m_h[x]):(age[5]+m_h[x]+u), (annee_naissance_2-1899)] / matrice_TG_F[(age[5]+1), (annee_naissance_2-1899)]
}


P_l<-(probas_survie_Homme_2_tetes+probas_survie_femme_2_tetes-probas_survie_Homme_2_tetes*probas_survie_femme_2_tetes)
Prime_Unique_2_tetes_var_homme<-Rente_2_var_homme*colSums(P_l*Actu_1)


#Prime annuelle

#On détermine le dénominateur

Denominateur_2_tetes_var_homme<-numeric(l)
for (x in 1:length(age)){
  actualisation_deno_homme<-cumprod(c(1,rep(v,m_h[x]-1)))
  L_cred_homme<-matrice_TG_H[(age[x]+1):(age[x]+m_h[x]), (annee_naissance_1[x]-1899)] / matrice_TG_H[(age[x]+1), (annee_naissance_1[x]-1899)]
  L_deb_homme<-matrice_TG_H[(40+1):(40+m_h[x]), (2022-40-1899)] / matrice_TG_H[(40+1), (2022-40-1899)]
  L_cred_femme<-matrice_TG_F[(age[5]+1):(age[5]+m_h[x]), (annee_naissance_2-1899)] / matrice_TG_F[(age[5]+1), (annee_naissance_2-1899)]
  Denominateur_2_tetes_var_homme[x]<-sum((L_cred_homme+L_cred_femme-L_cred_homme*L_cred_femme)*L_deb_homme*actualisation_deno_homme)
}

Prime_annuelle_2_tetes_var_homme<-Prime_Unique_2_tetes_var_homme/Denominateur_2_tetes_var_homme
```
On fait dès à présent varier l'âge du Crédirentier_2:
```{r}
annee_naissance_1<-2022-80 #annee de naissance du crédirentier
annee_naissance_2<-annee_naissance

maxi_f<-numeric(l)
for (x in 1:l){
  maxi_f[x]<-ceiling(max(esp_homme[5],esp_femme[x]))
}
m_f<-ceiling(maxi_f)+3
u<-5 

#Pour la suite des calculs, il faut redéterminer les facteurs d'actualisation, car nous allons de m à m+u-1
#et rien ne nous indique que m_f et m_h ont la même valeur 

Actu_1_f<-matrix(rep(0,l*u), ncol=l)

for (x in 1:l){
  Actu_1_f[,x]<-cumprod(rep(v,u))*(v**(m_f[x]-1))
}

#On passe désormais au calcul des différentes composantes de la formule finale
probas_survie_Femme_2_tetes<-matrix(rep(0, l*u),ncol=l)  
for (x in 1:l){
  probas_survie_Femme_2_tetes[,x]<-matrice_TG_F[(age[x]+1+m_f[x]):(age[x]+m_f[x]+u), (annee_naissance_2[x]-1899)] / matrice_TG_F[(age[x]+1), (annee_naissance_2[x]-1899)]
}

probas_survie_homme_2_tetes<-matrix(rep(0, l*u),ncol=l) 
for (x in 1:l){
  probas_survie_homme_2_tetes[,x]<-matrice_TG_H[(age[5]+1+m_f[x]):(age[5]+m_f[x]+u), (annee_naissance_1-1899)] / matrice_TG_H[(age[5]+1), (annee_naissance_1-1899)]
}

P_l_f<-(probas_survie_Femme_2_tetes+probas_survie_homme_2_tetes-probas_survie_Femme_2_tetes*probas_survie_homme_2_tetes)
Prime_Unique_2_tetes_var_femme<-Rente_2_var_femme*colSums(P_l_f*Actu_1_f)


#Prime annuelle 

#On détermine le dénominateur

Denominateur_2_tetes_var_femme<-numeric(l)
for (x in 1:length(age)){
  actualisation_deno_femme<-cumprod(c(1,rep(v,m_f[x]-1)))
  L_cred_homme<-matrice_TG_H[(age[5]+1):(age[5]+m_f[x]), (annee_naissance_1-1899)] / matrice_TG_H[(age[5]+1), (annee_naissance_1-1899)]
  L_deb_femme<-matrice_TG_H[(40+1):(40+m_f[x]), (2022-40-1899)] / matrice_TG_H[(40+1), (2022-40-1899)]
  L_cred_femme<-matrice_TG_F[(age[x]+1):(age[x]+m_f[x]), (annee_naissance_2[x]-1899)] / matrice_TG_F[(age[x]+1), (annee_naissance_2[x]-1899)]
  Denominateur_2_tetes_var_femme[x]<-sum((L_cred_homme+L_cred_femme-L_cred_homme*L_cred_femme)*L_deb_femme*actualisation_deno_femme)
}

Prime_annuelle_2_tetes_var_femme<-Prime_Unique_2_tetes_var_femme/Denominateur_2_tetes_var_femme
```
Graphiquement, 
```{r}
plot(age, Prime_Unique_2_tetes_var_homme, type="l", lwd=3, col='tomato3', main='Prime Unique risque longévité sur deux têtes - tables TGH05/TGF05', xlab='âge crédirentier', ylab = 'Prime unique', ylim=c(0,40000))
lines(age, Prime_Unique_2_tetes_var_femme, type="l", lwd=3, col='blue')
legend(
  'topleft',
  c('crédirentier homme/ crédirentière 80 ans', 'crédirentier femme/ crédirentier 80 ans'),
  col = c('tomato3','blue'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)

plot(age, Prime_annuelle_2_tetes_var_homme, type="l", lwd=3, col='tomato3', main='Prime Annuelle risque longévité sur deux têtes - tables TGH05/TGF05', xlab='âge crédirentier', ylab = 'Prime annuelle', ylim=c(0,4000))
lines(age, Prime_annuelle_2_tetes_var_femme, type="l", lwd=3, col='blue')
legend(
  'topleft',
  c('crédirentier homme/ crédirentière 80 ans', 'crédirentier femme/ crédirentier 80 ans'),
  col = c('tomato3','blue'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)

```

###Tables TVH00-02/TVF00-02

On commence par faire varier l'âge de Credirentier_1
```{r}
annee_naissance_2<-2022-80 #annee de naissance de la crédirentiere 
annee_naissance_1<-annee_naissance

#pour éviter les sorties de table, on peut rajouter des zéros pour avoir 122 lignes dans les tables

nouv_TVF<-c(TVF_vie_decal, rep(0,9))
nouv_TVH<-c(TVH_vie_decal, rep(0,9))

#Prime unique

maxi<-numeric(l)
for (x in 1:l){
  maxi[x]<-ceiling(max(esp_homme_TV[x],esp_femme_TV[5]))
}
m_h_TV<-ceiling(maxi)+3
u<-5 #même s'il a été déterminé auparavant, on le remet par lisibilité 

#Pour la suite des calculs, il faut redéterminer les facteurs d'actualisation, car nous allons de m à m+u-1
#et rien ne nous indique que m et n ont la même valeur 

Actu_1<-matrix(rep(0,l*u), ncol=l)

for (x in 1:l){
  Actu_1[,x]<-cumprod(rep(v,u))*(v**(m_h_TV[x]-1))
}

#On passe désormais au calcul des différentes composantes de la formule finale
probas_survie_Homme_2_tetes<-matrix(rep(0, l*u),ncol=l) 
probas_survie_femme_2_tetes<-matrix(rep(0, l*u),ncol=l) 

for (x in 1:l){
  probas_survie_Homme_2_tetes[,x]<-nouv_TVH[(age[x]+1+m_h_TV[x]):(age[x]+m_h_TV[x]+u)] / nouv_TVH[(age[x]+1)]
  probas_survie_femme_2_tetes[,x]<-nouv_TVF[(age[5]+1+m_h_TV[x]):(age[5]+m_h_TV[x]+u)] / nouv_TVF[(age[5]+1)]
}


P_l<-(probas_survie_Homme_2_tetes+probas_survie_femme_2_tetes-probas_survie_Homme_2_tetes*probas_survie_femme_2_tetes)
Prime_Unique_2_tetes_var_homme_TV<-Rente_2_var_homme_TV*colSums(P_l*Actu_1)


#Prime annuelle

#On détermine le dénominateur

Denominateur_2_tetes_var_homme_TV<-numeric(l)
for (x in 1:length(age)){
  actualisation_deno_homme<-cumprod(c(1,rep(v,m_h_TV[x]-1)))
  L_cred_homme<-nouv_TVH[(age[x]+1):(age[x]+m_h_TV[x])] / nouv_TVH[(age[x]+1)]
  L_deb_homme<-nouv_TVH[(40+1):(40+m_h_TV[x])] / nouv_TVH[(40+1)]
  L_cred_femme<-nouv_TVF[(age[5]+1):(age[5]+m_h_TV[x])] / nouv_TVF[(age[5]+1)]
  Denominateur_2_tetes_var_homme_TV[x]<-sum((L_cred_homme+L_cred_femme-L_cred_homme*L_cred_femme)*L_deb_homme*actualisation_deno_homme)
}

Prime_annuelle_2_tetes_var_homme_TV<-Prime_Unique_2_tetes_var_homme_TV/Denominateur_2_tetes_var_homme_TV

```
On fait dès à présent varier l'âge de Credirentier_2
```{r}

annee_naissance_1<-2022-80 #annee de naissance du crédirentier
annee_naissance_2<-annee_naissance

maxi_f<-numeric(l)
for (x in 1:l){
  maxi_f[x]<-ceiling(max(esp_homme_TV[5],esp_femme_TV[x]))
}
m_f_TV<-ceiling(maxi_f)+3
u<-5 

#Pour la suite des calculs, il faut redéterminer les facteurs d'actualisation, car nous allons de m à m+u-1
#et rien ne nous indique que m_f et m_h ont la même valeur 

Actu_1_f<-matrix(rep(0,l*u), ncol=l)

for (x in 1:l){
  Actu_1_f[,x]<-cumprod(rep(v,u))*(v**(m_f_TV[x]-1))
}

#On passe désormais au calcul des différentes composantes de la formule finale
probas_survie_Femme_2_tetes<-matrix(rep(0, l*u),ncol=l)  
for (x in 1:l){
  probas_survie_Femme_2_tetes[,x]<-nouv_TVF[(age[x]+1+m_f_TV[x]):(age[x]+m_f_TV[x]+u)] / nouv_TVF[(age[x]+1)] #pour 100 ans, on sort de la table: age max atteint
}

probas_survie_homme_2_tetes<-matrix(rep(0, l*u),ncol=l) 
for (x in 1:l){
  probas_survie_homme_2_tetes[,x]<-nouv_TVH[(age[5]+1+m_f_TV[x]):(age[5]+m_f_TV[x]+u)] / nouv_TVH[(age[5]+1)] #pour une crédirentière de 60 ans, on sort aussi de la table
}

P_l_f<-(probas_survie_Femme_2_tetes+probas_survie_homme_2_tetes-probas_survie_Femme_2_tetes*probas_survie_homme_2_tetes)
Prime_Unique_2_tetes_var_femme_TV<-Rente_2_var_femme_TV*colSums(P_l_f*Actu_1_f)


#Prime annuelle 

#On détermine le dénominateur (ici il ne sera pas nécessaire d'agrandir la taille des tables initiales)

Denominateur_2_tetes_var_femme_TV<-numeric(l)
for (x in 1:length(age)){
  actualisation_deno_femme<-cumprod(c(1,rep(v,m_f_TV[x]-1)))
  L_cred_homme<-TVH_vie_decal[(age[5]+1):(age[5]+m_f_TV[x])] / TVH_vie_decal[(age[5]+1)]
  L_deb_homme<-TVH_vie_decal[(40+1):(40+m_f_TV[x])] / TVH_vie_decal[(40+1)]
  L_cred_femme<-TVF_vie_decal[(age[x]+1):(age[x]+m_f_TV[x])] / TVF_vie_decal[(age[x]+1)]
  Denominateur_2_tetes_var_femme_TV[x]<-sum((L_cred_homme+L_cred_femme-L_cred_homme*L_cred_femme)*L_deb_homme*actualisation_deno_femme)
}

Prime_annuelle_2_tetes_var_femme_TV<-Prime_Unique_2_tetes_var_femme_TV/Denominateur_2_tetes_var_femme_TV
```
Graphiquement,
```{r}
plot(age, Prime_Unique_2_tetes_var_homme_TV, type="l", lwd=3, col='tomato3', main='Prime Unique risque longévité sur deux têtes - tables TVH00-02/TVF00-02', xlab='âge crédirentier', ylab = 'Prime unique', ylim=c(0,50000))
lines(age, Prime_Unique_2_tetes_var_femme_TV, type="l", lwd=3, col='blue')
legend(
  'topleft',
  c('crédirentier homme/ crédirentière 80 ans', 'crédirentier femme/ crédirentier 80 ans'),
  col = c('tomato3','blue'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .02
)

plot(age, Prime_annuelle_2_tetes_var_homme_TV, type="l", lwd=3, col='tomato3', main='Prime Annuelle risque longévité sur deux têtes - tables TVH00-02/TVF00-02', xlab='âge crédirentier', ylab = 'Prime annuelle', ylim=c(0,5000))
lines(age, Prime_annuelle_2_tetes_var_femme_TV, type="l", lwd=3, col='blue')
legend(
  'topleft',
  c('crédirentier homme/ crédirentière 80 ans', 'crédirentier femme/ crédirentier 80 ans'),
  col = c('tomato3','blue'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .02
)

```

##Prime risque décès 

On commence par faire varier l'âge du débirentier de 40 à 75 ans. Le crédirentier est fixé. On considère qu'il s'agit d'un homme de 80 ans. 

```{r}
age_debirentier<-seq(40,75,5)
t<-length(age_debirentier)
annee_naissance_deb<-2022-age_debirentier
```
Avant de rentrer dans les détails, comme nous déterminons le risque décès sur base d'une autre table(TD 00-02), nous devons redéterminer la rente. 
```{r}
#Détermination du DUH 
omega<-length(TVH_deces_decal)-1
v<-1/(1+0.02)

DUH_1_H_TD<-function(x){
  actualisation<-cumprod(rep(v,omega-age[x]))
  probas_survie_homme<-TVH_deces_decal[(age[x]+2):(omega+1)]/TVH_deces_decal[(age[x]+1)]
  return(sum(actualisation*probas_survie_homme)*Loyer)
}

DUH_1_F_TD<-function(x){
  actualisation<-cumprod(rep(v,omega-age[x]))
  probas_survie_femme<-TVF_deces_decal[(age[x]+2):(omega+1)]/TVF_deces_decal[(age[x]+1)]
  return(sum(actualisation*probas_survie_femme)*Loyer)
}

#Détermination de la rente

Rente_1_H_TD<-function(x){
  Capital_1_homme<-500000-DUH_1_H_TD(x)
  actualisation<-cumprod(c(1,rep(v,omega-age[x])))
  probas_survie_homme<-TVH_deces_decal[(age[x]+1):(omega+1)]/TVH_deces_decal[(age[x]+1)]
  return(Capital_1_homme/sum(actualisation*probas_survie_homme))
}

Rente_1_F_TD<-function(x){
  Capital_1_femme<-500000-DUH_1_F_TD(x)
  actualisation<-cumprod(c(1,rep(v,omega-age[x])))
  probas_survie_femme<-TVF_deces_decal[(age[x]+1):(omega+1)]/TVF_deces_decal[(age[x]+1)]
  return(Capital_1_femme/sum(actualisation*probas_survie_femme))
}

Rente_1_homme_TD<-apply(matrix(seq(1:length(age)), nrow=length(age)), 1, Rente_1_H_TD)
Rente_1_femme_TD<-apply(matrix(seq(1:length(age)), nrow=length(age)), 1, Rente_1_F_TD)

```
###Tables TGH05/TGF05(Variation débirentier)

```{r}
#Comme nous considérons un crédirentier fixe, nous pouvons aisément déterminer la Rente 
R_deces_cred_fixe<-Rente_1_homme[5] #age[5]=80

#Prime Unique
Omega<-length(matrice_TG_H[,1])-1 #On se remémore la valeur de l'âge final

proba_cred<-matrice_TG_H[(80+2):Omega, (2022-80-1899)] / matrice_TG_H[(80+1),(2022-80-1899)]
actualisation<-cumprod(rep(v,(Omega-80-1)))

Probas_cum_inv<-rev(cumsum(rev(proba_cred*actualisation)))

#On créer ensuite une matrice regroupant les probas de survie nécessaires pour chaque âge considéré
#(une colonne correspondant à un âge)
probas_deb_homme_1<-matrix(rep(0, t*(Omega-80-1)),ncol=t) 
probas_deb_homme_2<-matrix(rep(0, t*(Omega-80-1)),ncol=t) 
probas_deb_femme_1<-matrix(rep(0, t*(Omega-80-1)),ncol=t) 
probas_deb_femme_2<-matrix(rep(0, t*(Omega-80-1)),ncol=t)
for (x in 1:t){
  probas_deb_homme_1[,x]<-matrice_TG_H[(age_debirentier[x]+1):(age_debirentier[x]+Omega-80-1), (annee_naissance_deb[x]-1899)] / matrice_TG_H[(age_debirentier[x]+1), (annee_naissance_deb[x]-1899)]
  probas_deb_homme_2[,x]<-matrice_TG_H[(age_debirentier[x]+2):(age_debirentier[x]+Omega-80), (annee_naissance_deb[x]-1899)] / matrice_TG_H[(age_debirentier[x]+1), (annee_naissance_deb[x]-1899)]
  probas_deb_femme_1[,x]<-matrice_TG_F[(age_debirentier[x]+1):(age_debirentier[x]+Omega-80-1), (annee_naissance_deb[x]-1899)] / matrice_TG_F[(age_debirentier[x]+1), (annee_naissance_deb[x]-1899)]
  probas_deb_femme_2[,x]<-matrice_TG_F[(age_debirentier[x]+2):(age_debirentier[x]+Omega-80), (annee_naissance_deb[x]-1899)] / matrice_TG_F[(age_debirentier[x]+1), (annee_naissance_deb[x]-1899)]
}

probas_deb_homme<-probas_deb_homme_1-probas_deb_homme_2
probas_deb_femme<-probas_deb_femme_1-probas_deb_femme_2

Prime_unique_deces_cred_fixe_homme<-R_deces_cred_fixe*colSums(probas_deb_homme*Probas_cum_inv)
Prime_unique_deces_cred_fixe_femme<-R_deces_cred_fixe*colSums(probas_deb_femme*Probas_cum_inv)

#Prime annuelle

#On détermine le dénominateur

Denominateur_deces_cred_fixe_homme<-numeric(t)
Denominateur_deces_cred_fixe_femme<-numeric(t)
for (x in 1:t){
  actualisation_deno_cred_fixe<-cumprod(c(1,rep(v,(Omega-80-1))))
  L_deb_homme<-matrice_TG_H[(age_debirentier[x]+1):(age_debirentier[x]+Omega-80), (annee_naissance_deb[x]-1899)] / matrice_TG_H[(age_debirentier[x]+1), (annee_naissance_deb[x]-1899)]
  L_cred_fixe<-matrice_TG_H[(80+1):Omega, (2022-80-1899)] / matrice_TG_H[(80+1), (2022-80-1899)]
  L_deb_femme<-matrice_TG_F[(age_debirentier[x]+1):(age_debirentier[x]+Omega-80), (annee_naissance_deb[x]-1899)] / matrice_TG_F[(age_debirentier[x]+1), (annee_naissance_deb[x]-1899)]
  Denominateur_deces_cred_fixe_homme[x]<-sum(L_deb_homme*L_cred_fixe*actualisation_deno_cred_fixe)
  Denominateur_deces_cred_fixe_femme[x]<-sum(L_deb_femme*L_cred_fixe*actualisation_deno_cred_fixe)
}

Prime_annuelle_deces_cred_fixe_homme<-Prime_unique_deces_cred_fixe_homme/Denominateur_deces_cred_fixe_homme
Prime_annuelle_deces_cred_fixe_femme<-Prime_unique_deces_cred_fixe_femme/Denominateur_deces_cred_fixe_femme
```
Graphiquement, on obtient: 
```{r}
plot(age_debirentier, Prime_unique_deces_cred_fixe_homme, type="l", lwd=3, col='tomato3', main='Prime Unique risque décès - crédirentier fixe - tables TGH05/TGF05', xlab='âge débirentier', ylab = 'Prime unique', ylim=c(0,60000))
lines(age_debirentier, Prime_unique_deces_cred_fixe_femme, type="l", lwd=3, col='blue')
legend(
  'topleft',
  c('débirentier homme', 'débirentier femme'),
  col = c('tomato3','blue'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)

plot(age_debirentier, Prime_annuelle_deces_cred_fixe_homme, type="l", lwd=3, col='tomato3', main='Prime Annuelle risque décès - crédirentier fixe - tables TGH05/TGF05', xlab='âge débirentier', ylab = 'Prime annuelle', ylim=c(0,7000))
lines(age_debirentier, Prime_annuelle_deces_cred_fixe_femme, type="l", lwd=3, col='blue')
legend(
  'topleft',
  c('débirentier homme', 'débirentier femme'),
  col = c('tomato3','blue'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)
```

##Tables TDH00-02/TDF00-02(Variation débirentier)

```{r}
#Comme nous considérons un crédirentier fixe, nous pouvons aisément déterminer la Rente 
R_deces_cred_fixe_TD<-Rente_1_homme_TD[5]

#Prime Unique
omega<-length(TVH_deces_decal)-1 #age final

proba_cred_TD<-TVH_deces_decal[(80+2):omega] / TVH_deces_decal[(80+1)]
actualisation<-cumprod(rep(v,(omega-80-1)))

Probas_cum_inv_TD<-rev(cumsum(rev(proba_cred_TD*actualisation)))

#On créer ensuite une matrice regroupant les probas de survie nécessaires pour chaque âge considéré
#(une colonne correspondant à un âge)
probas_deb_homme_1<-matrix(rep(0, t*(omega-80-1)),ncol=t) 
probas_deb_homme_2<-matrix(rep(0, t*(omega-80-1)),ncol=t) 
probas_deb_femme_1<-matrix(rep(0, t*(omega-80-1)),ncol=t) 
probas_deb_femme_2<-matrix(rep(0, t*(omega-80-1)),ncol=t)
for (x in 1:t){
  probas_deb_homme_1[,x]<-TVH_deces_decal[(age_debirentier[x]+1):(age_debirentier[x]+omega-80-1)] / TVH_deces_decal[(age_debirentier[x]+1)]
  probas_deb_homme_2[,x]<-TVH_deces_decal[(age_debirentier[x]+2):(age_debirentier[x]+omega-80)] / TVH_deces_decal[(age_debirentier[x]+1)]
  probas_deb_femme_1[,x]<-TVF_deces_decal[(age_debirentier[x]+1):(age_debirentier[x]+omega-80-1)] / TVF_deces_decal[(age_debirentier[x]+1)]
  probas_deb_femme_2[,x]<-TVF_deces_decal[(age_debirentier[x]+2):(age_debirentier[x]+omega-80)] / TVF_deces_decal[(age_debirentier[x]+1)]
}

probas_deb_homme<-probas_deb_homme_1-probas_deb_homme_2
probas_deb_femme<-probas_deb_femme_1-probas_deb_femme_2

Prime_unique_deces_cred_fixe_homme_TD<-R_deces_cred_fixe_TD*colSums(probas_deb_homme*Probas_cum_inv_TD)
Prime_unique_deces_cred_fixe_femme_TD<-R_deces_cred_fixe_TD*colSums(probas_deb_femme*Probas_cum_inv_TD)

#Prime annuelle

#On détermine le dénominateur

Denominateur_deces_cred_fixe_homme_TD<-numeric(t)
Denominateur_deces_cred_fixe_femme_TD<-numeric(t)
for (x in 1:t){
  actualisation_deno_cred_fixe<-cumprod(c(1,rep(v,(omega-80-1))))
  L_deb_homme<-TVH_deces_decal[(age_debirentier[x]+1):(age_debirentier[x]+omega-80)] / TVH_deces[(age_debirentier[x]+1)]
  L_cred_fixe<-TVH_deces_decal[(80+1):omega] / TVH_deces_decal[(80+1)]
  L_deb_femme<-TVF_deces_decal[(age_debirentier[x]+1):(age_debirentier[x]+omega-80)] / TVF_deces_decal[(age_debirentier[x]+1)]
  Denominateur_deces_cred_fixe_homme_TD[x]<-sum(L_deb_homme*L_cred_fixe*actualisation_deno_cred_fixe)
  Denominateur_deces_cred_fixe_femme_TD[x]<-sum(L_deb_femme*L_cred_fixe*actualisation_deno_cred_fixe)
}

Prime_annuelle_deces_cred_fixe_homme_TD<-Prime_unique_deces_cred_fixe_homme_TD/Denominateur_deces_cred_fixe_homme_TD
Prime_annuelle_deces_cred_fixe_femme_TD<-Prime_unique_deces_cred_fixe_femme_TD/Denominateur_deces_cred_fixe_femme_TD
```
Graphiquement, on obtient: 
```{r}
plot(age_debirentier, Prime_unique_deces_cred_fixe_homme_TD, type="l", lwd=3, col='tomato3', main='Prime Unique risque décès - crédirentier fixe - tables TDH00-02/TDF00-02', xlab='âge débirentier', ylab = 'Prime unique', ylim=c(0,90000))
lines(age_debirentier, Prime_unique_deces_cred_fixe_femme_TD, type="l", lwd=3, col='blue')
legend(
  'topleft',
  c('débirentier homme', 'débirentier femme'),
  col = c('tomato3','blue'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)

plot(age_debirentier, Prime_annuelle_deces_cred_fixe_homme_TD, type="l", lwd=3, col='tomato3', main='Prime Annuelle risque décès - crédirentier fixe - tables TDH00-02/TDF00-02', xlab='âge débirentier', ylab = 'Prime annuelle', ylim=c(0,15000))
lines(age_debirentier, Prime_annuelle_deces_cred_fixe_femme_TD, type="l", lwd=3, col='blue')
legend(
  'topleft',
  c('débrientier homme', 'débirentier femme'),
  col = c('tomato3','blue'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)

```

On peut désormais fixer l'âge du débirentier à 40 ans, et considérer qu'il s'agit d'un homme. On fait désormais varier l'âge du crédirentier de 60 à 100 ans. 

###Tables TGH05/TGF05(Variation crédirentier)

```{r}
#Prime Unique
Omega<-length(matrice_TG_H[,1])-1

#On s'occupe des termes qui contiennent les probabilités de survie du crédirentier 

probabilites_credirentier_deces_H<-function(x){ #x correspond à l'indice dans le vecteur age
  proba_cred<-matrice_TG_H[(age[x]+2):Omega, (annee_naissance[x]-1899)] / matrice_TG_H[(age[x]+1),(annee_naissance[x]-1899)]
  actualisation<-cumprod(rep(v,(Omega-age[x]-1)))
  return(rev(cumsum(rev(proba_cred*actualisation))))
}

probabilites_credirentier_deces_F<-function(x){ #x correspond à l'indice dans le vecteur age
  proba_cred<-matrice_TG_F[(age[x]+2):Omega, (annee_naissance[x]-1899)] / matrice_TG_F[(age[x]+1),(annee_naissance[x]-1899)]
  actualisation<-cumprod(rep(v,(Omega-age[x]-1)))
  return(rev(cumsum(rev(proba_cred*actualisation))))
}

#On peut désormais passer aux probabilités de survie du crédirentier, en fonction des différents âges de crédirentier
#considéres

Prime_unique_deces_deb_fixe_H<-function(x){
  probas_deb_homme_1<-matrice_TG_H[(40+1):(40+Omega-age[x]-1), (2022-40-1899)] / matrice_TG_H[(40+1), (2022-40-1899)]
  probas_deb_homme_2<-matrice_TG_H[(40+2):(40+Omega-age[x]), (2022-40-1899)] / matrice_TG_H[(40+1), (2022-40-1899)]
  probas_deb_homme<-probas_deb_homme_1-probas_deb_homme_2
  Probas_cum_inv_deb_fixe<-probabilites_credirentier_deces_H(x)
  return(Rente_1_homme[x]*sum(probas_deb_homme*Probas_cum_inv_deb_fixe))
}

Prime_unique_deces_deb_fixe_F<-function(x){
  probas_deb_homme_1<-matrice_TG_H[(40+1):(40+Omega-age[x]-1), (2022-40-1899)] / matrice_TG_H[(40+1), (2022-40-1899)]
  probas_deb_homme_2<-matrice_TG_H[(40+2):(40+Omega-age[x]), (2022-40-1899)] / matrice_TG_H[(40+1), (2022-40-1899)]
  probas_deb_homme<-probas_deb_homme_1-probas_deb_homme_2
  Probas_cum_inv_deb_fixe<-probabilites_credirentier_deces_F(x)
  return(Rente_1_femme[x]*sum(probas_deb_homme*Probas_cum_inv_deb_fixe))
}

Prime_unique_deces_deb_fixe_homme<-apply(matrix(seq(1,l), nrow=l), 1, Prime_unique_deces_deb_fixe_H)
Prime_unique_deces_deb_fixe_femme<-apply(matrix(seq(1,l), nrow=l), 1, Prime_unique_deces_deb_fixe_F)

#Prime annuelle 

#On détermine le dénominateur

Denominateur_deces_deb_fixe_homme<-numeric(l)
Denominateur_deces_deb_fixe_femme<-numeric(l)
for (x in 1:l){
  actualisation_deno_deb_fixe<-cumprod(c(1,rep(v,(Omega-age[x]-1))))
  L_deb<-matrice_TG_H[(40+1):(40+Omega-age[x]), (2022-40-1899)] / matrice_TG_H[(40+1),(2022-40-1899)]
  L_cred_homme<-matrice_TG_H[(age[x]+1):Omega,(annee_naissance[x]-1899)] / matrice_TG_H[(age[x]+1), (annee_naissance[x]-1899)]
  L_cred_femme<-matrice_TG_F[(age[x]+1):Omega,(annee_naissance[x]-1899)] / matrice_TG_F[(age[x]+1),(annee_naissance[x]-1899)]
  Denominateur_deces_deb_fixe_homme[x]<-sum(L_deb*L_cred_homme*actualisation_deno_deb_fixe)
  Denominateur_deces_deb_fixe_femme[x]<-sum(L_deb*L_cred_femme*actualisation_deno_deb_fixe)
}

Prime_annuelle_deces_deb_fixe_homme<-Prime_unique_deces_deb_fixe_homme/Denominateur_deces_deb_fixe_homme
Prime_annuelle_deces_deb_fixe_femme<-Prime_unique_deces_deb_fixe_femme/Denominateur_deces_deb_fixe_femme
```
Graphiquement, nous obtenons:
```{r}

plot(age, Prime_unique_deces_deb_fixe_homme, type="l", lwd=3, col='tomato3', main='Prime Unique risque décès - débirentier fixe - tables TGH05/TGF05', xlab='âge crédirentier', ylab = 'Prime unique', ylim=c(0,3500))
lines(age, Prime_unique_deces_deb_fixe_femme, type="l", lwd=3, col='blue')
legend(
  'topright',
  c('crédirentier homme', 'crédirentier femme'),
  col = c('tomato3','blue'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)

plot(age, Prime_annuelle_deces_deb_fixe_homme, type="l", lwd=3, col='tomato3', main='Prime Annuelle risque décès - débirentier fixe - tables TGH05/TGF05', xlab='âge crédirentier', ylab = 'Prime annuelle', ylim=c(0,300))
lines(age, Prime_annuelle_deces_deb_fixe_femme, type="l", lwd=3, col='blue')
legend(
  'topleft',
  c('crédirentier homme', 'crédirentier femme'),
  col = c('tomato3','blue'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)
```

###Tables TVH00-02/TVF00-02(Variation crédirentier)
```{r}
#Prime Unique
omega<-length(TVH_deces_decal)-1

#On s'occupe des termes qui contiennent les probabilités de survie du crédirentier 

probabilites_credirentier_deces_H_TD<-function(x){ #x correspond à l'indice dans le vecteur age
  proba_cred<-TVH_deces_decal[(age[x]+2):omega] / TVH_deces_decal[(age[x]+1)]
  actualisation<-cumprod(rep(v,(omega-age[x]-1)))
  return(rev(cumsum(rev(proba_cred*actualisation))))
}

probabilites_credirentier_deces_F_TD<-function(x){ #x correspond à l'indice dans le vecteur age
  proba_cred<-TVF_deces_decal[(age[x]+2):omega] / TVF_deces_decal[(age[x]+1)]
  actualisation<-cumprod(rep(v,(omega-age[x]-1)))
  return(rev(cumsum(rev(proba_cred*actualisation))))
}

#On peut désormais passer aux probabilités de survie du crédirentier, en fonction des différents âges de crédirentier
#considéres

Prime_unique_deces_deb_fixe_H_TD<-function(x){
  probas_deb_homme_1<-TVH_deces_decal[(40+1):(40+omega-age[x]-1)] / TVH_deces_decal[(40+1)]
  probas_deb_homme_2<-TVH_deces_decal[(40+2):(40+omega-age[x])] / TVH_deces_decal[(40+1)]
  probas_deb_homme<-probas_deb_homme_1-probas_deb_homme_2
  Probas_cum_inv_deb_fixe<-probabilites_credirentier_deces_H_TD(x)
  return(Rente_1_homme_TD[x]*sum(probas_deb_homme*Probas_cum_inv_deb_fixe))
}

Prime_unique_deces_deb_fixe_F_TD<-function(x){
  probas_deb_homme_1<-TVH_deces_decal[(40+1):(40+omega-age[x]-1)] / TVH_deces_decal[(40+1)]
  probas_deb_homme_2<-TVH_deces_decal[(40+2):(40+omega-age[x])] / TVH_deces_decal[(40+1)]
  probas_deb_homme<-probas_deb_homme_1-probas_deb_homme_2
  Probas_cum_inv_deb_fixe<-probabilites_credirentier_deces_F_TD(x)
  return(Rente_1_femme_TD[x]*sum(probas_deb_homme*Probas_cum_inv_deb_fixe))
}

Prime_unique_deces_deb_fixe_homme_TD<-apply(matrix(seq(1,l), nrow=l), 1, Prime_unique_deces_deb_fixe_H_TD)
Prime_unique_deces_deb_fixe_femme_TD<-apply(matrix(seq(1,l), nrow=l), 1, Prime_unique_deces_deb_fixe_F_TD)

#Prime annuelle 

#On détermine le dénominateur

Denominateur_deces_deb_fixe_homme_TD<-numeric(l)
Denominateur_deces_deb_fixe_femme_TD<-numeric(l)
for (x in 1:l){
  actualisation_deno_deb_fixe<-cumprod(c(1,rep(v,(omega-age[x]-1))))
  L_deb<-TVH_deces_decal[(40+1):(40+omega-age[x])] / TVH_deces_decal[(40+1)]
  L_cred_homme<-TVH_deces_decal[(age[x]+1):omega] / TVH_deces_decal[(age[x]+1)]
  L_cred_femme<-TVF_deces_decal[(age[x]+1):omega] / TVF_deces_decal[(age[x]+1)]
  Denominateur_deces_deb_fixe_homme_TD[x]<-sum(L_deb*L_cred_homme*actualisation_deno_deb_fixe)
  Denominateur_deces_deb_fixe_femme_TD[x]<-sum(L_deb*L_cred_femme*actualisation_deno_deb_fixe)
}

Prime_annuelle_deces_deb_fixe_homme_TD<-Prime_unique_deces_deb_fixe_homme_TD/Denominateur_deces_deb_fixe_homme_TD
Prime_annuelle_deces_deb_fixe_femme_TD<-Prime_unique_deces_deb_fixe_femme_TD/Denominateur_deces_deb_fixe_femme_TD
```
Nous obtenons alors les graphiques suivants:
```{r}
plot(age, Prime_unique_deces_deb_fixe_homme_TD, type="l", lwd=3, col='tomato3', main='Prime Unique risque décès - débirentier fixe - tables TVH00-02/TVF00-02', xlab='âge crédirentier', ylab = 'Prime unique', ylim=c(0,15000))
lines(age, Prime_unique_deces_deb_fixe_femme_TD, type="l", lwd=3, col='blue')
legend(
  'topright',
  c('crédirentier homme', 'crédirentier femme'),
  col = c('tomato3','blue'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)


plot(age, Prime_annuelle_deces_deb_fixe_homme_TD, type="l", lwd=3, col='tomato3', main='Prime Annuelle risque décès - débirentier fixe - tables TVH00-02/TVF00-02', xlab='âge crédirentier', ylab = 'Prime', ylim=c(0,1500))
lines(age, Prime_annuelle_deces_deb_fixe_femme_TD, type="l", lwd=3, col='blue')
legend(
  'topleft',
  c('crédirentier homme', 'crédirentier femme'),
  col = c('tomato3','blue'),
  cex=0.9,
  lwd = 3,
  box.lty = 0,
  bg = 'gray95',
  inset = .05
)
```